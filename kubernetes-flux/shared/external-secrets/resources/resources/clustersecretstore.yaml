# https://external-secrets.io/latest/api/clustersecretstore/
# yaml-language-server: $schema=https://raw.githubusercontent.com/datreeio/CRDs-catalog/refs/heads/main/external-secrets.io/clustersecretstore_v1.json

apiVersion: external-secrets.io/v1
kind: ClusterSecretStore
metadata:
  name: kv2
spec:
  provider:
    webhook:
      method: POST
      url: "http://kv2.tailscale-system.svc.cluster.local:8080/secrets.v1.Kv2Service/GetSecret"
      body: '{"key":"{{.remoteRef.key}}"}'
      result:
        jsonPath: "$.secret.value"
      headers:
        Content-Type: "application/json"
  conditions:
    - namespaceSelector:
        matchLabels:
          kube.huggins.io/eso: "allow"
